<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>betterJS ‚Äì Auth & API Framework</title>
<link rel="stylesheet" href="js/style.css">
<script src="js/crypto.js"></script>
<script src="js/betterJS.js"></script>
<script src="js/ui.js"></script>
</head>
<body>

<header>
  <h1>‚ö° betterJS Auth & API Framework</h1>
  <nav>
    <button class="tablink active" onclick="ui.switchTab('authTab', this)">Login</button>
    <button class="tablink" onclick="ui.switchTab('docsTab', this)">Docs</button>
    <button class="tablink" onclick="ui.switchTab('apiTab', this)">API Demo</button>
    <button class="tablink" onclick="ui.switchTab('setupTab', this)">Setup</button>
  </nav>
</header>

<main>
  <!-- AUTH -->
  <section id="authTab" class="tab active">
    <h2>üîê Benutzer-Login</h2>

    <div id="unlockSection">
      <p>Bitte trage deinen Freischaltcode ein, um Zugriff zu erhalten:</p>
      <input id="unlockCode" placeholder="Freischaltcode (AES)">
      <button onclick="handleUnlock()">Freischalten</button>
    </div>

    <div id="authBox" style="display:none;">
      <input id="username" placeholder="Benutzername">
      <input id="password" type="password" placeholder="Passwort">
      <button onclick="handleRegister()">Registrieren</button>
      <button onclick="handleLogin()">Login</button>
    </div>

    <div id="emailBox" style="display:none;">
      <h3>Email-Registrierung (manuell)</h3>
      <input id="emailInput" type="email" placeholder="Deine Email">
      <input id="siteInput" placeholder="Deine Website (API-Host)">
      <input id="nameInput" placeholder="Dein Name">
      <button onclick="ui.sendUnlockRequest()">Freischaltcode anfordern</button>
    </div>

    <pre id="output"></pre>
  </section>

  <!-- DOCS -->
  <section id="docsTab" class="tab">
    <h2>üìñ Dokumentation</h2>
    <p><b>betterJS</b> ist ein serverloses Authentifizierungs-Framework.  
      Du kannst User registrieren, verschl√ºsseln, Login validieren und deine App absichern ‚Äì alles auf GitHub Pages!</p>

    <h3>ConfigData Parameter</h3>
    <ul>
      <li><code>registerMethod</code> ‚Äì "manual" oder "auto"</li>
      <li><code>encryptionLevel</code> ‚Äì "l" / "m" / "h"</li>
      <li><code>developerEmail</code> ‚Äì Empf√§ngeradresse f√ºr FormSubmit</li>
      <li><code>unlockCode</code> ‚Äì AES-verschl√ºsselter Developer-Code</li>
    </ul>
  </section>

  <!-- API DEMO -->
  <section id="apiTab" class="tab">
    <h2>üß© API Beispiel</h2>
    <p>So kannst du betterJS-Funktionen in deiner eigenen App nutzen:</p>
    <pre><code>betterJS.logInUser({ username:"max", password:"1234" });</code></pre>

    <button onclick="ui.demoAPI()">Testausgabe</button>
    <pre id="apiOutput"></pre>
  </section>

  <!-- SETUP -->
  <section id="setupTab" class="tab">
    <h2>üõ†Ô∏è Anleitung</h2>
    <ol>
      <li>Erstelle <code>src/JSON/userData.json</code></li>
      <li>Setze alle Parameter in <code>configData</code></li>
      <li>Deploye auf GitHub Pages</li>
      <li>Verwende <b>FormSubmit</b> f√ºr E-Mail-Verbindungen</li>
    </ol>
  </section>
</main>

<footer>
  <small>¬© 2025 betterJS | Serverless Auth System</small>
</footer>

<!-- CONFIGDATA -->
<script>
const configData = [{
  "userData": "src/JSON/userData.json",
  "registerMethod": "manual",
  "developerEmail": "dev@example.com",
  "unlockCode": "b64encodedAESEncryptedCode==",
  "unlockKey": "meinPasswort123",
  "encryptionLevel": "h",
  "pwKeyLength": 12,
  "colorSuccess": "#00d084",
  "colorWarning": "#ffd43b",
  "colorError": "#ff4d4d",
  "showCookieBanner": true,
  "cookieStorageKey": "betterJS_cookie",
  "redirectAfterRgisteration": false
}];
const res = [{}];

betterJS.setConfig(configData);
betterJS.setResponseVar(res);

async function handleUnlock(){
  const codeInput = document.getElementById('unlockCode').value;
  const enc = configData[0].unlockCode;
  const key = configData[0].unlockKey;
  try {
    const dec = await cryptingEncoder.decryptAES(key, enc);
    if(dec === codeInput){
      document.getElementById('unlockSection').style.display='none';
      document.getElementById('authBox').style.display='block';
      ui.interpretResponse({level:1, content:{msg:"Freischaltung erfolgreich"}});
    } else {
      ui.interpretResponse({level:3, content:{error:"Ung√ºltiger Code"}});
    }
  } catch(e){
    ui.interpretResponse({level:3, content:{error:"Fehler bei der Codepr√ºfung"}});
  }
}

async function handleRegister(){
  const user = {
    username: document.getElementById('username').value,
    password: document.getElementById('password').value
  };
  await betterJS.registerUser(user);
  ui.interpretResponse(betterJS.latestResponse());
}

async function handleLogin(){
  const user = {
    username: document.getElementById('username').value,
    password: document.getElementById('password').value
  };
  await betterJS.logInUser(user);
  ui.interpretResponse(betterJS.latestResponse());
}
</script>
</body>
</html>
